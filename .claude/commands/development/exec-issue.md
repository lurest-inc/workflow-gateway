# 内容

`gh issue view $ARGUMENTS` でGitHubのIssueの内容を確認し、タスクの遂行を行なってください。
タスクは以下の手順で進めてください。コメントなどは全て日本語でお願いします。

## フェーズ1: Issue理解と校正 (Codex担当)

1. ClaudeCode: Issueに記載されている内容を理解する
2. Codex: `mcp__codex__codex`ツールを使用してIssueの内容を校正する
   - **セキュリティ注意**: Issueに秘密鍵、APIトークン、個人情報、顧客データ、社内限定設計が含まれる場合は、必ずマスキングまたは除外してから送信すること。社外送信不可データは要約のみ、または送信禁止とする
   - プロンプト例: 「以下のGitHub Issueの内容を日本語で校正してください。不明瞭な点や改善提案は**最大5項目**、各項目は**2文以内**で簡潔にまとめてください。回答は日本語で、適切な絵文字を含めてください。」
   - Codexからのフィードバックを確認し、必要に応じてIssueにコメントで質問する
   - **フォールバック**: `mcp__codex__codex`がエラー、権限拒否、未設定の場合は即座にClaudeCodeで校正を実施

## フェーズ2: ブランチ準備 (ClaudeCode担当)

3. ClaudeCode: `main` にチェックアウトし、pullを行い、最新のリモートの状態を取得する
4. ClaudeCode: `issues/#$ARGUMENTS` でブランチを作成、チェックアウトする

## フェーズ3: タスク計画 (Codex担当)

5. Codex: `mcp__codex__codex`ツールを使用して実行計画を作成する
   - **セキュリティ注意**: Issueに秘密鍵、APIトークン、個人情報、顧客データ、社内限定設計が含まれる場合は、必ずマスキングまたは除外してから送信すること
   - プロンプト例: 「以下のIssue内容から実行計画を作成してください。タスクを箇条書きで、依存関係があれば順序を示し、Issueコメント向けの短い文章も作成してください。日本語で、適切な絵文字を含めてください。」
   - Codexからの実行計画を確認し、必要に応じてClaudeCodeで調整する
   - **フォールバック**: `mcp__codex__codex`がエラー、権限拒否、未設定の場合は即座にClaudeCodeで実行計画を作成
6. ClaudeCode: 実行計画を適宜Issueにコメントとして残す

## フェーズ4: 実装とテスト (ClaudeCode + Codex)

7. Codex: `mcp__codex__codex`ツールを使用して実装前の調査・方針を整理する
   - **セキュリティ注意**: 機密情報が含まれる場合は、必ずマスキングまたは除外してから送信すること
   - プロンプト例: 「以下の変更要件に対して、実装方針と影響範囲（影響ファイル候補）を整理してください。日本語で、適切な絵文字を含めてください。」
   - Codexからの方針整理を確認し、必要に応じてClaudeCodeで調整する
   - **フォールバック**: `mcp__codex__codex`がエラー、権限拒否、未設定の場合は即座にClaudeCodeで方針整理を実施
8. ClaudeCode: 実行計画と実装方針に従い、タスクを実行する

## フェーズ5: セルフレビュー (Codex担当)

9. Codex: `mcp__codex__codex`ツールを使用して実装内容をレビューする
    - **セキュリティ注意**: diffに秘密鍵、APIトークン、個人情報、顧客データ、社内限定設計が含まれる場合は、必ずマスキングまたは除外してから送信すること。社外送信不可データは要約で代替、または送信禁止とする
    - プロンプト例: 「以下の変更内容を日本語でレビューしてください。コーディング規約、セキュリティ、パフォーマンス、バグの可能性について確認してください。回答は日本語で、適切な絵文字を含めてください。」
    - 変更されたファイルのdiffを含める
    - Codexからのレビューコメントに基づいて必要な修正を実施
    - **フォールバック**: `mcp__codex__codex`がエラー、権限拒否、未設定の場合は即座にClaudeCodeでセルフレビューを実施

## フェーズ6: コミット・プッシュ (Codex + ClaudeCode)

10. Codex + ClaudeCode: `mcp__codex__codex`ツールでConventional Commits形式のコミットメッセージを作成し、適切な粒度でコミットを作成する
    - **セキュリティ注意**: diffに機密情報が含まれる場合は、必ずマスキングまたは除外してから送信すること
    - プロンプト例: 「以下のdiffからConventional Commits形式のコミットメッセージを作成してください。日本語で、適切な絵文字を含めてください。」
    - Codexの提案を確認し、ClaudeCodeがコミットを実行する
    - **フォールバック**: `mcp__codex__codex`がエラー、権限拒否、未設定の場合は即座にClaudeCodeでコミットメッセージを作成

## フェーズ7: PRと課題作成 (Codex + ClaudeCode)

11. Codex + ClaudeCode: `mcp__codex__codex`ツールでPR descriptionを作成し、PRを作成する
    - **セキュリティ注意**: diffに機密情報が含まれる場合は、必ずマスキングまたは除外してから送信すること
    - プロンプト例: 「以下の変更点からPR descriptionを作成してください。冒頭に `Closes #$ARGUMENTS` を入れてください。日本語で、適切な絵文字を含めてください。」
    - Codexの提案を確認し、ClaudeCodeがPRを作成する
    - **フォールバック**: `mcp__codex__codex`がエラー、権限拒否、未設定の場合は即座にClaudeCodeでPR descriptionを作成
12. ClaudeCode: 課題を見つければ、別途Issueを起票する
